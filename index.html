<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance Tracker (Google Sheets)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4 font-sans">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-4xl">
        <h1 class="text-4xl font-extrabold text-center text-green-700 mb-8">Google Sheets Attendance Tracker</h1>

        <!-- Date Navigation -->
        <div class="flex justify-center items-center space-x-4 mb-6">
            <button id="prevDay" class="px-4 py-2 bg-green-500 text-white rounded-lg shadow-md hover:bg-green-600 transition duration-300 ease-in-out">
                &lt; Previous Day
            </button>
            <span id="currentDate" class="text-2xl font-semibold text-gray-800"></span>
            <button id="nextDay" class="px-4 py-2 bg-green-500 text-white rounded-lg shadow-md hover:bg-green-600 transition duration-300 ease-in-out">
                Next Day &gt;
            </button>
        </div>

        <!-- Student List -->
        <div id="studentList" class="space-y-4 max-h-96 overflow-y-auto pr-2">
            <!-- Student items will be dynamically loaded here -->
        </div>

        <!-- Save Button -->
        <div class="mt-8 text-center">
            <button id="saveAttendance" class="px-8 py-4 bg-blue-600 text-white text-xl font-bold rounded-xl shadow-lg hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105">
                Save Attendance to Google Sheet
            </button>
        </div>
    </div>

    <!-- The URL of your Google Apps Script web app -->
    <!-- REPLACE THIS URL WITH YOUR DEPLOYED APPS SCRIPT URL -->
    <script>
        // NOTE: In a real app, this URL would point to your Google Apps Script Web App
        // that handles the Google Sheets API calls securely.
        const GOOGLE_SHEETS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyN_UkevQZkCpw_tYcNSUysrC0ivV3NadkDBmaj0YcNJpTEkj4f6uVCcF1j-j0dJCI3FQ/exec';

        const studentListDiv = document.getElementById('studentList');
        const students = Array.from({length: 30}, (_, i) => ({ id: `student${i + 1}`, name: `Student ${i + 1}` }));
        let currentDate = new Date(); // Start with today's date

        // Utility function to format date as YYYY-MM-DD
        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // Renders the attendance UI for the current date
        const renderAttendance = () => {
            studentListDiv.innerHTML = ''; // Clear previous list
            document.getElementById('currentDate').textContent = formatDate(currentDate);

            if (students.length === 0) {
                studentListDiv.innerHTML = '<p class="text-center text-gray-600">No students found.</p>';
                return;
            }

            // Note: This version does not load previous attendance from Google Sheets
            // as that would require a more complex backend function.
            // All checkboxes will be unchecked by default.

            students.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg shadow-sm hover:bg-gray-100 transition duration-200 ease-in-out';
                studentItem.innerHTML = `
                    <span class="text-lg font-medium text-gray-700">${student.name}</span>
                    <input type="checkbox" id="attendance-${student.id}" data-student-id="${student.id}"
                           class="form-checkbox h-6 w-6 text-blue-600 rounded-md border-gray-300 focus:ring-blue-500">
                `;
                studentListDiv.appendChild(studentItem);
            });
        };

        // Function to save attendance to the Google Sheet
        const saveAttendance = async () => {
            const attendanceDate = formatDate(currentDate);
            const attendanceData = {};
            students.forEach(student => {
                const checkbox = document.getElementById(`attendance-${student.id}`);
                if (checkbox) {
                    attendanceData[student.id] = checkbox.checked;
                }
            });

            // Prepare the data to be sent to the backend script
            const payload = {
                date: attendanceDate,
                attendance: attendanceData
            };

            try {
                // Simulate an API call to a backend script
                if (GOOGLE_SHEETS_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    console.error("Please replace the placeholder URL with your Google Apps Script URL.");
                    alertMessage("Please set up your Google Apps Script first!", "red");
                    return;
                }
                
                const response = await fetch(GOOGLE_SHEETS_WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alertMessage("Attendance saved to Google Sheet!", "green");
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || "Unknown error occurred.");
                }

            } catch (error) {
                console.error("Error saving attendance to Google Sheet:", error);
                alertMessage("Error saving attendance: " + error.message, "red");
            }
        };

        // Simple alert message function (replaces alert())
        const alertMessage = (message, type) => {
            const existingAlert = document.getElementById('customAlert');
            if (existingAlert) {
                existingAlert.remove();
            }

            const alertDiv = document.createElement('div');
            alertDiv.id = 'customAlert';
            alertDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 ${type === 'green' ? 'bg-green-500' : 'bg-red-500'}`;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        };

        // Event Listeners
        document.addEventListener('DOMContentLoaded', renderAttendance);

        document.getElementById('prevDay').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 1);
            renderAttendance();
        });

        document.getElementById('nextDay').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 1);
            renderAttendance();
        });

        document.getElementById('saveAttendance').addEventListener('click', saveAttendance);
    </script>
</body>
</html>
